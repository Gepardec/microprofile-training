<ui:composition template="/WEB-INF/layout/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:tag="http://tags.microprofile.training.gepardec.com">

    <ui:define name="title">
        Basics Microprofile-Metrics SimplyTimed
    </ui:define>

    <ui:define name="body">
        <section>
            <div class="container-lg">
                <div class="row my-2">
                    <div class="col">
                        <div class="text-center">
                            <h1>SimplyTimed</h1>
                        </div>
                    </div>
                </div>

                <div class="row my-2">
                    <div class="col">
                        <p>
                            The specification for Microprofile
                            <a href="https://download.eclipse.org/microprofile/microprofile-metrics-3.0/microprofile-metrics-spec-3.0.html#_simplytimed"
                               target="_blank">
                                Metrics (SimplyTimed).
                            </a>
                        </p>

                        <p>
                            <code>@SimplyTimed</code> is an annotation for marking a constructor or method of an annotated object as simply timed. The
                            metric of type SimpleTimer tracks the count of invocations of the annotated object and tracks how
                            long it took the invocations to complete
                        </p>

                        <hr class="my-3" />
                    </div>
                </div>

                <div class="row my-2">
                    <div class="col">
                        <section>
                            <h4>
                                Your Task:
                            </h4>

                            <p>
                                Use <code>@SimplyTimed</code> to measure the duration and how often the method <code>simpleTime()</code>
                                in <code>com.gepardec.training.microprofile.basic.metrics.ExampleController</code> was called. The name fo the metric should be <code>"simply-timed-example"</code>.
                                Make sure that the metric is displayed at
                                <a href="http://localhost:9990/metrics"
                                   target="_blank">
                                    Wildfly
                                </a>
                                and
                                <a href="http://localhost:19090/"
                                   target="_blank">
                                    Prometheus.
                                </a>

                            </p>

                            <hr class="my-3" />

                            <div class="text-center">
                                <tag:button id="callTimeEndpoint" text="Start" path="/basic/metrics/simple-time"/>
                                <tag:button id="stopCallingTimeEndpoint" text="Stop" />
                            </div>
                            <div class="row my-1">
                                <div class="col-sm text-lg-start text-sm-right mr-sm-1">
                                    Elapsed time (in seconds):
                                </div>
                                <div class="col-sm text-center text-sm-left ml-sm-1">
                                    <h:outputText id="serverResponse" value="${time}"/>
                                </div>
                            </div>

                            <hr class="my-3" />
                        </section>
                    </div>
                </div>
            </div>
        </section>
    </ui:define>

    <ui:define name="bottom">
        <tag:timerDialog id="timer" title="Waiting for response..." text="This should not take longer than 1 second" />

        <script type="module">
            import mp from '#{pathHelper.buildResourcePath("/js/mp.js")}'
            import metered from '#{pathHelper.buildResourcePath("/js/basic/metrics/metered.js")}'

            mp.registerOnLoad(() => {
                metered.init({
                    delayMillis: 1000,
                    callerElement: document.getElementById("callTimeEndpoint"),
                    stopElement: document.getElementById("stopCallingTimeEndpoint"),
                    responseElement: document.getElementById("serverResponse"),
                });
            });
        </script>
    </ui:define>
</ui:composition>



