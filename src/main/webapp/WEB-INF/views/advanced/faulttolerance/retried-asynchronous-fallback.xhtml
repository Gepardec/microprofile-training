<ui:composition template="/WEB-INF/layout/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:tag="http://tags.microprofile.training.gepardec.com">

    <ui:define name="title">
        Advanced Fault-Tolerance (Retry, Asynchronous and Fallback)
    </ui:define>

    <ui:define name="body">
        <section>
            <div class="text-center">
                <h1>Retry, Asynchronous, and Fallback</h1>
            </div>
            <div class="mt-3">
                <p>
                    The specification for Microprofile
                    <a href="#{mpUri.faultToleranceUri}"
                       target="_blank">
                        Fault Tolerance
                    </a>
                </p>

                <p>
                    Asynchronous method invocations may fail and can have a a retry behaviour and a fallback defined.
                </p>

                <hr class="my-3"/>
            </div>

            <div class="row my-2">
                <div class="col">
                    <section>
                        <h4>
                            Your Task:
                        </h4>

                        <p>
                            The code changes have to be done in
                            <code>com.gepardec.training.microprofile.advanced.faulttolerance.RetriedAsynchronousFallbackService#invoke</code>.
                            <br/>
                            Test your changes after each step.
                        </p>

                        <ol>
                            <li>Make the method <code>invoke</code> asynchronous</li>
                            <li>Provide a fallback result</li>
                            <li>Define a retry beahviour:
                                <ul>
                                    <li>Define a retry behaviour where the method invokation still fails</li>
                                    <li>Define a retry behaviour where the method invokations succeeds</li>
                                </ul>
                            </li>
                        </ol>

                        <div class="alert alert-info mt-2" role="alert">
                            <b>Hint:</b> Maybe there is something worng with the return type :)
                        </div>

                        <p>
                            Click the button below to trigger the asynchronous invocation.
                        </p>

                        <div class="text-center">
                            <tag:button id="callAsynchronousEndpoint"
                                        path="/advanced/faulttolerance/retried-asynchronous-fallback/invoke"
                                        text="Send"/>
                        </div>

                        <hr class="my-3"/>
                    </section>
                </div>
            </div>

            <div class="row my-2 text-start">

                <div class="col-sm me-sm-1 font-weight-bold">
                    Server Response:
                </div>
                <div id="serverResponse" class="col-sm ms-sm-1" style="word-wrap: break-word;">
                </div>

                <hr class="my-3"/>
            </div>
        </section>
    </ui:define>


    <ui:define name="bottom">
        <script type="module">
            import mp from '#{pathHelper.buildResourcePath("/js/mp.js")}'
            import asynchronousFallback
                from '#{pathHelper.buildResourcePath("/js/advanced/faulttolerance/retried-asynchronous-fallback.js")}'

            mp.registerOnLoad(() => asynchronousFallback.init({
                clickElement: document.getElementById("callAsynchronousEndpoint"),
                responseElement: document.getElementById('serverResponse'),
            }));
        </script>
    </ui:define>
</ui:composition>
